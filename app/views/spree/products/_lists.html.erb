<% products.each_with_index do |product, index| %>
  <% if index % 4 == 0 %>
    <% @column = 0 %>
    <div class="clearfix">
  <% end %>
  <li id="product_<%= product.id %>" variant_id="<%= product.master.id%>" class="span2" data-hook="products_list_item" itemscope itemtype="http://schema.org/Product">
    <div class="product-image">
      <%= link_to small_image(product, :itemprop => "image", :class=>"img-rounded"), product, :itemprop => 'url' %>
      <span class="original-price"><%= number_to_currency product.original_price %></span>
      <span class="price selling" itemprop="price"><%= number_to_currency product.price %></span>
    </div>

    <%= link_to truncate(product.name, :length => 50), product, :itemprop => "name", :title => product.name %>

    <% unless product.has_stock? %>
      <a href="#" class="btn out-of-stock disabled" price ="<%= product.price %>"><%= t(:out_of_stock) %></a>
    <% else %>
      <% if product.available_on > Time.now %>
        <span class='coming-product'>Hàng sắp về</span>
      <% else %>
        <a class="btn add-to-cart" price ="<%= product.price %>"><%= t(:add_to_cart) %></a>
      <% end %>
    <% end %>

  </li>
  <% @column += 1 %>
  <% if index == products.length || @column == 4 %>
    </div>
  <% end %>
<% end %>


